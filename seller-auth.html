<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† - CasseDZ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

    <!-- Ù…ÙƒØªØ¨Ø© Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style> body { font-family: 'Cairo', sans-serif; } </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-md p-6">
        
        <!-- Ø§Ù„Ø´Ø¹Ø§Ø± -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-black text-blue-700 tracking-tighter">
                Casse<span class="text-orange-500">DZ</span>
            </h1>
            <p class="text-gray-500 font-bold mt-2 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-gray-400">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-11.25a.75.75 0 0 0-1.5 0v2.5h-2.5a.75.75 0 0 0 0 1.5h2.5v2.5a.75.75 0 0 0 1.5 0v-2.5h2.5a.75.75 0 0 0 0-1.5h-2.5v-2.5Z" clip-rule="evenodd" />
                </svg>
                ÙØ¶Ø§Ø¡ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙˆØ±Ø´Ø§Øª
            </p>
        </div>

        <!-- Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden">
            
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
            <div class="flex border-b border-gray-100">
                <button onclick="switchTab('login')" id="loginTabBtn" class="flex-1 py-4 font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50 transition">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
                <button onclick="switchTab('signup')" id="signupTabBtn" class="flex-1 py-4 font-bold text-gray-400 hover:text-gray-600 transition">
                    ÙØªØ­ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <!-- ÙÙˆØ±Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div id="loginForm" class="p-8">
                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" id="loginPhone" placeholder="0550 12 34 56" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold text-lg text-left" dir="ltr" required>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold text-lg" required>
                    </div>
                    <button type="submit" id="loginBtn" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-blue-700 transition mt-2 flex justify-center items-center gap-2">
                        Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­Ø³Ø§Ø¨
                    </button>
                </form>
                <p class="text-center mt-4 text-sm text-gray-400 font-bold cursor-pointer hover:text-blue-600">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</p>
            </div>

            <!-- ÙÙˆØ±Ù… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
            <div id="signupForm" class="p-8 hidden">
                <form onsubmit="handleSignup(event)" class="space-y-3">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø© (Ø§Ù„Ù…Ø­Ù„)</label>
                        <input type="text" id="shopName" placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙƒØ§Ø³ Ø¨Ø§Ø¨ Ø§Ù„Ø²ÙˆØ§Ø±" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold" required>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label>
                            <select id="signupWilaya" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none font-bold text-sm">
                                <option>Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
                                <option>ÙˆÙ‡Ø±Ø§Ù†</option>
                                <option>Ø³Ø·ÙŠÙ</option>
                                <option>Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©</option>
                                <option>Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©</option>
                                <option>Ø¹Ù†Ø§Ø¨Ø©</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                            <input type="tel" id="signupPhone" placeholder="0550..." class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none font-bold text-left" dir="ltr" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="signupPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none font-bold" required>
                    </div>
                    <button type="submit" id="signupBtn" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-black transition mt-2 flex justify-center items-center gap-2">
                        Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    </button>
                </form>
            </div>
        </div>

        <p class="text-center mt-8 text-gray-400 text-sm">Â© 2024 CasseDZ - Business</p>
    </div>

    <script>
        // --- Ø±Ø§Ø¨Ø· Supabase ---
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_KEY';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // --- Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ---
        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const loginBtn = document.getElementById('loginTabBtn');
            const signupBtn = document.getElementById('signupTabBtn');

            if(tab === 'login') {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                loginBtn.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
                loginBtn.classList.remove('text-gray-400');
                signupBtn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
                signupBtn.classList.add('text-gray-400');
            } else {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                signupBtn.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
                signupBtn.classList.remove('text-gray-400');
                loginBtn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
                loginBtn.classList.add('text-gray-400');
            }
        }

        // --- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;
            const originalText = btn.innerHTML;

            const fakeEmail = phone + "@cassedz.com";

            btn.disabled = true;
            btn.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: fakeEmail,
                    password: password
                });

                if (error) throw error;

                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                window.location.href = 'seller.html';
            } catch (error) {
                alert("Ø®Ø·Ø£! ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.");
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // --- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ---
        async function handleSignup(e) {
            e.preventDefault();
            const btn = document.getElementById('signupBtn');
            const shopName = document.getElementById('shopName').value;
            const wilaya = document.getElementById('signupWilaya').value;
            const phone = document.getElementById('signupPhone').value;
            const password = document.getElementById('signupPassword').value;
            const originalText = btn.innerHTML;

            const fakeEmail = phone + "@cassedz.com";

            if(password.length < 6) {
                alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...";

            try {
                // 1- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙÙŠ Supabase Auth
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: fakeEmail,
                    password: password
                });

                if (authError) throw authError;

                // 2- Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ sellers
                if (authData.user) {
                    const { error: dbError } = await supabase
                        .from('sellers')
                        .insert([{
                            id: authData.user.id,
                            shop_name: shopName,
                            wilaya: wilaya,
                            phone: phone,
                            balance: 1500,
                            status: "active"
                        }]);

                    if (dbError) throw dbError;
                }

                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ù„Ø¯ÙŠÙƒ 1500 Ø¯Ø¬ Ø±ØµÙŠØ¯ Ù…Ø¬Ø§Ù†ÙŠ ğŸ‰");
                window.location.href = 'seller.html';

            } catch (error) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + error.message);
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
    </script>
</body>
</html>