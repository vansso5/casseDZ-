<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±ÙˆØ¶ÙŠ Ø§Ù„Ù…Ø±Ø³Ù„Ø© - CasseDZ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Ù…ÙƒØªØ¨Ø© SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Cairo', sans-serif; }
        /* Ø¥Ø®ÙØ§Ø¡ Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø£ÙÙ‚ÙŠ ÙÙŠ Ø§Ù„ÙÙ„ØªØ± */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 pb-24">

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="bg-white p-4 shadow-sm sticky top-0 z-50">
        <div class="flex justify-between items-center">
            <h1 class="text-xl font-black text-gray-900">Ø¹Ø±ÙˆØ¶ÙŠ Ø§Ù„Ù…Ø±Ø³Ù„Ø© ğŸ“¤</h1>
            <a href="seller.html" class="bg-gray-50 p-2 rounded-full w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-200 border border-gray-200 transition">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                </svg>
            </a>
        </div>
        
        <!-- ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø§Øª -->
        <div class="flex gap-2 mt-4 overflow-x-auto pb-1 scrollbar-hide">
            <button onclick="filterOffers('all', this)" class="filter-btn bg-blue-600 text-white px-5 py-2 rounded-full font-bold text-xs whitespace-nowrap shadow-md shadow-blue-200 transition">
                Ø§Ù„ÙƒÙ„
            </button>
            <button onclick="filterOffers('pending', this)" class="filter-btn bg-white text-gray-600 px-5 py-2 rounded-full font-bold text-xs whitespace-nowrap border border-gray-200 transition">
                â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯
            </button>
            <button onclick="filterOffers('accepted', this)" class="filter-btn bg-white text-gray-600 px-5 py-2 rounded-full font-bold text-xs whitespace-nowrap border border-gray-200 transition">
                âœ… Ù…Ù‚Ø¨ÙˆÙ„Ø©
            </button>
        </div>
    </header>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø±ÙˆØ¶ -->
    <main id="offersContainer" class="container mx-auto px-4 mt-6 space-y-4 min-h-[300px]">
        <div id="loadingIndicator" class="text-center py-10">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto"></div>
            <p class="mt-3 text-gray-500 font-bold text-sm">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¹Ø±ÙˆØ¶Ùƒ...</p>
        </div>
    </main>

    <!-- Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ© -->
    <div id="emptyState" class="hidden text-center py-10">
        <div class="bg-gray-200 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 text-gray-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.126A59.768 59.768 0 0 1 21.485 12 59.77 59.77 0 0 1 3.27 20.876L5.999 12Zm0 0h7.5" />
            </svg>
        </div>
        <h3 class="font-bold text-gray-500">Ù…Ø§ Ø¨Ø¹Ø«Øª Ø­ØªÙ‰ Ø¹Ø±Ø¶</h3>
        <p class="text-xs text-gray-400 mt-2">Ø±ÙˆØ­ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ´ÙˆÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-6 py-2 flex justify-between items-center z-40">
        <a href="seller.html" class="flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-gray-900 transition">
            <span class="text-2xl">ğŸ </span>
            <span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="seller-offers.html" class="flex flex-col items-center gap-1 p-2 text-blue-600 transition">
            <span class="text-2xl">ğŸ“‹</span>
            <span class="text-[10px] font-bold">Ø·Ù„Ø¨Ø§ØªÙŠ</span>
        </a>
        <a href="seller-sales.html" class="flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-gray-900 transition">
            <span class="text-2xl">ğŸ’°</span>
            <span class="text-[10px] font-bold">Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
        </a>
        <a href="seller-settings.html" class="flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-gray-900 transition">
            <span class="text-2xl">âš™ï¸</span>
            <span class="text-[10px] font-bold">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </a>
    </nav>

    <script>
        // âš ï¸ Ø¶Ø¹ Ø±ÙˆØ§Ø¨Ø· Supabase Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù‡Ù†Ø§
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_KEY';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        let allOffers = [];

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
        async function initPage() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                window.location.href = 'seller-login.html'; 
                return;
            }
            fetchMyOffers(session.user.id);
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¨Ø§Ø¦Ø¹
        async function fetchMyOffers(userId) {
            try {
                const { data, error } = await supabase
                    .from('offers')
                    .select('*')
                    .eq('seller_id', userId)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allOffers = data;
                document.getElementById('loadingIndicator').classList.add('hidden');
                renderOffers(allOffers);

            } catch (error) {
                console.error(error);
                document.getElementById('loadingIndicator').innerHTML = "<p class='text-red-500'>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>";
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶
        function renderOffers(offersToRender) {
            const container = document.getElementById('offersContainer');
            const emptyState = document.getElementById('emptyState');
            container.innerHTML = '';

            if (!offersToRender || offersToRender.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }

            offersToRender.forEach(offer => {
                const isAccepted = offer.status === 'accepted';
                const statusText = isAccepted ? 'ØªÙ… Ø§Ù„Ø¨ÙŠØ¹' : 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯';
                const statusBg = isAccepted ? 'bg-green-500' : 'bg-yellow-400';
                const badgeBg = isAccepted ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700';

                const dateObj = new Date(offer.created_at);
                const dateStr = dateObj.toLocaleDateString('ar-DZ') + ' â€¢ ' + dateObj.toLocaleTimeString([], { hour: '2-digit', minute:'2-digit' });

                const phoneButton = isAccepted && offer.customer_phone ? `
                    <a href="tel:${offer.customer_phone}" class="mt-3 w-full bg-green-50 text-green-700 font-bold py-2 rounded-xl text-xs flex justify-center items-center gap-2 hover:bg-green-100 transition">
                        ğŸ“ Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø²Ø¨ÙˆÙ†
                    </a>` : '';

                container.innerHTML += `
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-200 relative overflow-hidden transition hover:shadow-md mb-4">
                    <div class="absolute left-0 top-0 bottom-0 w-1.5 ${statusBg}"></div>
                    <div class="flex gap-3">
                        <div class="w-20 h-20 bg-gray-100 rounded-lg overflow-hidden shrink-0 border border-gray-100">
                            <img src="${offer.image_url || 'https://via.placeholder.com/150'}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-gray-800 text-sm">${offer.part_name || 'Ù‚Ø·Ø¹Ø©'} - ${offer.car_details || 'Ø³ÙŠØ§Ø±Ø©'}</h3>
                                <span class="${badgeBg} text-[10px] font-bold px-2 py-1 rounded-full flex items-center gap-1">${statusText}</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶:</p>
                            <div class="flex justify-between items-end mt-1">
                                <p class="font-black text-blue-900 text-lg">${offer.price} Ø¯Ø¬</p>
                                <p class="text-[10px] text-gray-400">${dateStr}</p>
                            </div>
                        </div>
                    </div>
                    ${phoneButton}
                </div>`;
            });
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶
        window.filterOffers = (type, btn) => {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                b.classList.add('bg-white', 'text-gray-600', 'border');
            });
            btn.classList.remove('bg-white', 'text-gray-600', 'border');
            btn.classList.add('bg-blue-600', 'text-white', 'shadow-md');

            if (type === 'all') renderOffers(allOffers);
            else if (type === 'accepted') renderOffers(allOffers.filter(o => o.status === 'accepted'));
            else renderOffers(allOffers.filter(o => o.status !== 'accepted'));
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        initPage();
    </script>
</body>
</html>