<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f97316">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ | La Casse Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style> 
        body { font-family: 'Tajawal', sans-serif; background-color: #111827; } 
        .glass { background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        select option { background-color: #111827; color: white; }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col justify-center items-center p-4">

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="glass fixed top-0 w-full z-50">
        <div class="max-w-lg mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2 group">
                <div class="bg-gray-800 p-2 rounded-xl group-hover:bg-gray-700 transition border border-gray-700">
                    <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 12H5m7 7l-7-7 7-7"></path></svg>
                </div>
            </a>
            <h1 class="text-lg font-bold tracking-tight">ØªØ³Ø¬ÙŠÙ„ <span class="text-orange-500">Ø§Ù„Ø¯Ø®ÙˆÙ„</span></h1>
            <div class="w-10"></div>
        </div>
    </header>

    <!-- Ø§Ù„Ø´Ø¹Ø§Ø± -->
    <div class="mb-8 text-center mt-16">
        <h1 class="text-3xl font-bold text-white">La Casse <span class="text-orange-500">Pro</span></h1>
        <p class="text-gray-400 text-sm mt-1">Ø¨ÙˆØ§Ø¨Ø© Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙˆØ±Ø´Ø§Øª</p>
    </div>

    <!-- Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="bg-gray-800 p-6 rounded-2xl w-full max-w-sm border border-gray-700 shadow-2xl relative mb-10">
        
        <!-- Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
        <div class="flex border-b border-gray-700 mb-6">
            <button onclick="showLogin()" id="tab-login" class="flex-1 pb-2 text-orange-500 border-b-2 border-orange-500 font-bold transition">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="showRegister()" id="tab-register" class="flex-1 pb-2 text-gray-500 font-bold transition">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="loginForm" class="space-y-4">
            <div>
                <label class="text-xs text-gray-400">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="loginEmail" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500 text-left" dir="ltr">
            </div>
            <div>
                <label class="text-xs text-gray-400">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                <input type="password" id="loginPassword" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500">
            </div>
            <div class="flex justify-end">
                <button type="button" onclick="openForgotModal()" class="text-xs text-orange-400 hover:text-orange-300 underline cursor-pointer transition">
                    Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ
                </button>
            </div>
            <button type="button" id="sellerLoginBtn" class="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 rounded-xl shadow-lg mt-2 transition transform active:scale-95 flex justify-center items-center gap-2">
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
            </button>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
        <div id="registerForm" class="space-y-4 hidden">
            <div>
                <label class="text-xs text-gray-400">Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø© Ø§Ùˆ Ø§Ù„Ù…Ø­Ù„</label>
                <input type="text" id="regShopName" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500">
            </div>
            <div class="flex gap-2">
                <div class="flex-1">
                    <label class="text-xs text-gray-400">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label>
                    <select id="regWilaya" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500 cursor-pointer">
                        <option value="" disabled selected>Ø§Ø®ØªØ±...</option>
                        <option value="1">01 - Adrar</option>
                        <option value="2">02 - Chlef</option>
                        <option value="3">03 - Laghouat</option>
                        <option value="4">04 - Oum El Bouaghi</option>
                        <option value="5">05 - Batna</option>
                        <option value="6">06 - BÃ©jaÃ¯a</option>
                        <option value="7">07 - Biskra</option>
                        <option value="8">08 - BÃ©char</option>
                        <option value="9">09 - Blida</option>
                        <option value="10">10 - Bouira</option>
                        <option value="11">11 - Tamanrasset</option>
                        <option value="12">12 - TÃ©bessa</option>
                        <option value="13">13 - Tlemcen</option>
                        <option value="14">14 - Tiaret</option>
                        <option value="15">15 - Tizi Ouzou</option>
                        <option value="16">16 - Alger</option>
                        <option value="17">17 - Djelfa</option>
                        <option value="18">18 - Jijel</option>
                        <option value="19">19 - SÃ©tif</option>
                        <option value="20">20 - SaÃ¯da</option>
                        <option value="21">21 - Skikda</option>
                        <option value="22">22 - Sidi Bel AbbÃ¨s</option>
                        <option value="23">23 - Annaba</option>
                        <option value="24">24 - Guelma</option>
                        <option value="25">25 - Constantine</option>
                        <option value="26">26 - MÃ©dÃ©a</option>
                        <option value="27">27 - Mostaganem</option>
                        <option value="28">28 - M'Sila</option>
                        <option value="29">29 - Mascara</option>
                        <option value="30">30 - Ouargla</option>
                        <option value="31">31 - Oran</option>
                        <option value="32">32 - El Bayadh</option>
                        <option value="33">33 - Illizi</option>
                        <option value="34">34 - Bordj Bou Arreridj</option>
                        <option value="35">35 - BoumerdÃ¨s</option>
                        <option value="36">36 - El Tarf</option>
                        <option value="37">37 - Tindouf</option>
                        <option value="38">38 - Tissemsilt</option>
                        <option value="39">39 - El Oued</option>
                        <option value="40">40 - Khenchela</option>
                        <option value="41">41 - Souk Ahras</option>
                        <option value="42">42 - Tipaza</option>
                        <option value="43">43 - Mila</option>
                        <option value="44">44 - AÃ¯n Defla</option>
                        <option value="45">45 - NaÃ¢ma</option>
                        <option value="46">46 - AÃ¯n TÃ©mouchent</option>
                        <option value="47">47 - GhardaÃ¯a</option>
                        <option value="48">48 - Relizane</option>
                        <option value="49">49 - Timimoun</option>
                        <option value="50">50 - Bordj Badji Mokhtar</option>
                        <option value="51">51 - Ouled Djellal</option>
                        <option value="52">52 - BÃ©ni AbbÃ¨s</option>
                        <option value="53">53 - In Salah</option>
                        <option value="54">54 - In Guezzam</option>
                        <option value="55">55 - Touggourt</option>
                        <option value="56">56 - Djanet</option>
                        <option value="57">57 - El M'Ghair</option>
                        <option value="58">58 - El Meniaa</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label class="text-xs text-gray-400">Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</label>
                    <input type="text" id="regBaladiya" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500 text-center">
                </div>
            </div>
            <div>
                <label class="text-xs text-gray-400">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ <span class="text-orange-500">*</span></label>
                <input type="email" id="regEmail" placeholder="email@gmail.com" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500 text-left" dir="ltr">
            </div>
            <div>
                <label class="text-xs text-gray-400">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="tel" id="regPhone" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500 text-left font-mono" dir="ltr">
            </div>
            <div>
                <label class="text-xs text-gray-400">ÙƒÙ„Ù…Ø© Ø³Ø± Ø¬Ø¯ÙŠØ¯Ø©</label>
                <input type="password" id="regPassword" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500">
            </div>
            <div class="bg-gray-900/50 p-3 rounded-lg border border-dashed border-gray-600">
                <label class="text-xs font-bold text-orange-400 mb-2 block">ØµÙˆØ±Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­Ù„ ( Ø§Ø¬Ø¨Ø§Ø±ÙŠ )</label>
                <input type="file" id="regShopImage" accept="image/*" class="block w-full text-xs text-gray-400 file:mr-0 file:ml-2 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600 cursor-pointer"/>
            </div>
            <button type="button" id="btnRegister" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-xl border border-gray-500 mt-2">
                Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ (+1500 Ø¯Ø¬)
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± -->
    <div id="forgotModal" class="fixed inset-0 bg-black/90 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-gray-800 w-full max-w-sm p-8 rounded-2xl border border-gray-600 shadow-2xl relative">
            <button onclick="closeForgotModal()" class="absolute top-4 left-4 text-gray-400 hover:text-white transition">âœ•</button>
            <div class="text-center mb-6">
                <div class="w-12 h-12 bg-orange-500/20 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl">ğŸ”’</div>
                <h3 class="text-xl font-bold text-white">Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
                <p class="text-xs text-gray-400 mt-2">Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨.</p>
            </div>
            <div class="mb-6">
                <input type="email" id="forgotEmail" placeholder="example@gmail.com" class="w-full bg-gray-900 border border-gray-500 rounded-xl p-4 text-white focus:border-orange-500 text-left transition" dir="ltr">
            </div>
            <div class="flex flex-col gap-3">
                <button id="btnSendReset" class="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 rounded-xl shadow-lg transition">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                <button onclick="closeForgotModal()" class="w-full bg-transparent border border-gray-600 text-gray-400 hover:text-white font-bold py-3 rounded-xl transition">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- UI Logic Scripts -->
    <script>
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('tab-login').className = "flex-1 pb-2 text-orange-500 border-b-2 border-orange-500 font-bold transition";
            document.getElementById('tab-register').className = "flex-1 pb-2 text-gray-500 font-bold transition";
        }

        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('tab-login').className = "flex-1 pb-2 text-gray-500 font-bold transition";
            document.getElementById('tab-register').className = "flex-1 pb-2 text-orange-500 border-b-2 border-orange-500 font-bold transition";
        }

        function openForgotModal() { document.getElementById('forgotModal').classList.remove('hidden'); }
        function closeForgotModal() { document.getElementById('forgotModal').classList.add('hidden'); }
    </script>

    <!-- ========================================== -->
    <!-- ÙƒÙˆØ¯ FIREBASE (Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ù„Ù…ØµÙ„Ø­) -->
    <!-- ========================================== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            sendPasswordResetEmail,
            onAuthStateChanged,
            setPersistence,        
            browserLocalPersistence,
            signOut 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
        const firebaseConfig = {
          apiKey: "AIzaSyDLNY-Uya4tpZSplAqhpsmxgOrwlQMFODI",
          authDomain: "casse-auto-8ef9a.firebaseapp.com",
          databaseURL: "https://casse-auto-8ef9a-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "casse-auto-8ef9a",
          storageBucket: "casse-auto-8ef9a.firebasestorage.app",
          messagingSenderId: "257994887284",
          appId: "1:257994887284:web:16e6006f68520fbbc94121"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // ğŸ”¥ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø³Ø­Ø±ÙŠ Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
        let isRegistering = false;

        function showToast(msg, type = "success") {
            Toastify({
                text: msg,
                duration: 3000,
                gravity: "top",
                position: "center",
                style: {
                    background: type === "success" ? "#f97316" : "#ef4444",
                    borderRadius: "10px",
                    fontWeight: "bold"
                }
            }).showToast();
        }

        // ==========================================
        // 1. Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ù…Ø¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­)
        // ==========================================
        onAuthStateChanged(auth, async (user) => {
            // ğŸ›‘ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ØªØ¬Ø§Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ ØªÙ…Ø§Ù…Ø§Ù‹
            if (isRegistering) {
                console.log("Blocking Auth Listener due to registration process...");
                return;
            }

            if (user) {
                const docRef = doc(db, "sellers", user.uid);
                try {
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        
                        // ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚Ø¯ÙŠÙ…
                        if (data.status === 'pending') {
                            await signOut(auth);
                            showToast("Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.", "error");
                        } else if (data.status === 'active') {
                            window.location.href = "dash.html"; 
                        } else if (data.status === 'banned') {
                             await signOut(auth);
                             showToast("ØªÙ… Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨.", "error");
                        }
                    } else {
                        console.log("User logged in but doc not ready yet (handled by register flow).");
                    }
                } catch (error) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                }
            }
        });

        // ==========================================
        // 2. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        // ==========================================
        const loginBtn = document.getElementById('sellerLoginBtn');
        loginBtn.addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");
                return;
            }

            loginBtn.innerHTML = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¯Ø®ÙˆÙ„...";
            loginBtn.disabled = true;

            try {
                await setPersistence(auth, browserLocalPersistence);
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error(error);
                let msg = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„";
                if(error.code === 'auth/invalid-credential') msg = "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£";
                showToast(msg, "error");
                loginBtn.innerHTML = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
                loginBtn.disabled = false;
            }
        });

        // ==========================================
        // 3. Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ (Ù…Ø¹ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚ÙÙ„)
        // ==========================================
        const regBtn = document.getElementById('btnRegister');
        regBtn.addEventListener('click', async () => {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const shopName = document.getElementById('regShopName').value;
            const phone = document.getElementById('regPhone').value;
            const wilaya = document.getElementById('regWilaya').value;
            const baladiya = document.getElementById('regBaladiya').value;
            const fileInput = document.getElementById('regShopImage');

            if (!email || !password || !shopName || !phone || !wilaya || !fileInput.files[0]) {
                showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ù„", "error");
                return;
            }

            // ğŸ”’ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚ÙÙ„ Ù„Ù…Ù†Ø¹ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ù…Ù† Ø§Ù„ØªØ¯Ø®Ù„
            isRegistering = true;
            
            regBtn.innerHTML = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...";
            regBtn.disabled = true;

            try {
                // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // 2. Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
                const file = fileInput.files[0];
                const storageRef = ref(storage, `shops/${user.uid}/${file.name}`);
                await uploadBytes(storageRef, file);
                const imageUrl = await getDownloadURL(storageRef);

                // 3. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…)
                await setDoc(doc(db, "sellers", user.uid), {
                    shopName: shopName,
                    email: email,
                    phone: phone,
                    wilaya: wilaya,
                    baladiya: baladiya,
                    imageUrl: imageUrl,
                    balance: 1500,
                    createdAt: new Date(),
                    status: "pending"
                });

                showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨! Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.", "success");
                
                // 4. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙÙˆØ±Ø§Ù‹ (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…)
                await signOut(auth);

                // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… ØªØ­Ø±ÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                setTimeout(() => {
                    regBtn.innerHTML = "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ (+1500 Ø¯Ø¬)";
                    regBtn.disabled = false;
                    isRegistering = false; // ğŸ”“ ÙØªØ­ Ø§Ù„Ù‚ÙÙ„
                    showLogin();
                }, 2000);

            } catch (error) {
                console.error(error);
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø©
                if (auth.currentUser) await signOut(auth);

                let msg = "Ø®Ø·Ø£: " + error.message;
                if(error.code === 'auth/email-already-in-use') msg = "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„";
                
                showToast(msg, "error");
                regBtn.innerHTML = "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ (+1500 Ø¯Ø¬)";
                regBtn.disabled = false;
                isRegistering = false; // ğŸ”“ ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
            }
        });

        // ==========================================
        // 4. Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
        // ==========================================
        document.getElementById('btnSendReset').addEventListener('click', async () => {
            const email = document.getElementById('forgotEmail').value;
            if (!email) {
                showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹", "error");
                return;
            }
            try {
                await sendPasswordResetEmail(auth, email);
                showToast("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", "success");
                closeForgotModal();
            } catch (error) {
                showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø±ÙŠØ¯", "error");
            }
        });

    </script>
</body>
</html>